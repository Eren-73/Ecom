<!-- orders/templates/orders/checkout.html --><!-- templates/orders/checkout.html -->

<!-- Page de paiement/checkout avec design moderne --><!DOCTYPE html>

<!-- RELEVANT FILES: orders/views.py, orders/models.py, orders/cart.html --><html lang="fr">

<head>

<!DOCTYPE html>    <meta charset="UTF-8">

<html lang="fr">    <title>Paiement - R√©sum√© de commande</title>

<head>    <style>

    <meta charset="UTF-8">        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }

    <meta name="viewport" content="width=device-width, initial-scale=1.0">        h1 { margin-bottom: 20px; }

    <title>üí≥ Paiement - E-commerce</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">        .container { display: flex; gap: 40px; flex-wrap: wrap; }

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">        .cart, .payment { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex: 1; min-width: 300px; }

    <style>

        body {        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;        th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        th { background-color: #007bff; color: white; }

            min-height: 100vh;        .total { font-weight: bold; font-size: 1.2em; }

            padding: 40px 0;

        }        button { padding: 10px 20px; background-color: #6772E5; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }

        button:hover { background-color: #5469d4; }

        .checkout-container {

            max-width: 1200px;        h2 { margin-top: 0; }

            margin: 0 auto;

        }        p { font-size: 0.85em; color: #555; }

    </style>

        .checkout-header {</head>

            background: white;<body>

            border-radius: 20px;    <h1>R√©sum√© de votre commande</h1>

            padding: 30px;

            margin-bottom: 30px;    {% if cart_items %}

            box-shadow: 0 10px 40px rgba(0,0,0,0.1);    <div class="container">

        }        <!-- R√©capitulatif du panier -->

        <div class="cart">

        .checkout-header h1 {            <h2>Votre panier</h2>

            color: #667eea;            <table>

            font-weight: 700;                <thead>

            margin: 0;                    <tr>

            display: flex;                        <th>Produit</th>

            align-items: center;                        <th>Quantit√©</th>

            gap: 15px;                        <th>Prix unitaire</th>

        }                        <th>Sous-total</th>

                    </tr>

        .steps {                </thead>

            display: flex;                <tbody>

            justify-content: space-between;                    {% for item in cart_items %}

            margin-top: 20px;                    <tr>

        }                        <td>{{ item.product.name }}</td>

                        <td>{{ item.quantity }}</td>

        .step {                        <td>{{ item.product.price }} ‚Ç¨</td>

            flex: 1;                        <td>{{ item.subtotal }} ‚Ç¨</td>

            text-align: center;                    </tr>

        }                    {% endfor %}

                    <tr>

        .step-number {                        <td colspan="3" class="total">Total</td>

            width: 50px;                        <td class="total">{{ total_amount }} ‚Ç¨</td>

            height: 50px;                    </tr>

            border-radius: 50%;                </tbody>

            background: #e0e0e0;            </table>

            color: #666;        </div>

            display: inline-flex;

            align-items: center;        <!-- Paiement Stripe -->

            justify-content: center;        <div class="payment">

            font-weight: bold;            <h2>Paiement s√©curis√©</h2>

            font-size: 1.2rem;            <form action="{% url 'checkout' %}" method="post">

            margin-bottom: 10px;                {% csrf_token %}

        }                <button type="submit">Payer {{ total_amount }} ‚Ç¨ avec Stripe</button>

            </form>

        .step.active .step-number {            <p>

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);                Vous serez redirig√© vers Stripe pour finaliser le paiement. Utilisez les cartes de test (ex : 4242 4242 4242 4242) pour un projet scolaire.

            color: white;            </p>

        }        </div>

    </div>

        .step.completed .step-number {    {% else %}

            background: #28a745;        <p>Votre panier est vide. <a href="{% url 'home' %}">Retour √† l'accueil</a></p>

            color: white;    {% endif %}

        }</body>

</html>

        .checkout-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .checkout-card h3 {
            color: #333;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-image-small {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
        }

        .product-price {
            color: #667eea;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px 15px;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .summary-line {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            font-size: 1.1rem;
        }

        .summary-total {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
            margin-top: 15px;
        }

        .btn-pay {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            width: 100%;
        }

        .btn-back {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container checkout-container">
        <div class="checkout-header">
            <h1><i class="fas fa-credit-card"></i> Finaliser votre commande</h1>
            <div class="steps">
                <div class="step completed">
                    <div class="step-number"><i class="fas fa-check"></i></div>
                    <div>Panier</div>
                </div>
                <div class="step active">
                    <div class="step-number">2</div>
                    <div>Paiement</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div>Confirmation</div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-7">
                <div class="checkout-card">
                    <h3><i class="fas fa-shipping-fast"></i> Adresse de livraison</h3>
                    <form method="POST">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">Adresse compl√®te</label>
                            <textarea name="shipping_address" class="form-control" rows="3" required></textarea>
                        </div>
                        
                        <div class="checkout-card mt-4" style="background: #f8f9fa; box-shadow: none;">
                            <h3><i class="fas fa-credit-card"></i> M√©thode de paiement</h3>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="payment_method" id="card" value="card" checked>
                                <label class="form-check-label" for="card">
                                    <i class="fab fa-cc-visa"></i> Carte bancaire
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="payment_method" id="cash" value="cash">
                                <label class="form-check-label" for="cash">
                                    <i class="fas fa-money-bill-wave"></i> Paiement √† la livraison
                                </label>
                            </div>
                        </div>

                        <div class="d-flex gap-3 mt-4">
                            <a href="{% url 'cart_detail' %}" class="btn-back flex-fill text-center text-decoration-none">
                                <i class="fas fa-arrow-left"></i> Retour
                            </a>
                            <button type="submit" class="btn-pay flex-fill">
                                <i class="fas fa-lock"></i> Confirmer
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="col-lg-5">
                <div class="checkout-card">
                    <h3><i class="fas fa-receipt"></i> Votre commande</h3>
                    
                    {% if cart_items %}
                        {% for item in cart_items %}
                        <div class="order-item">
                            {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="product-image-small">
                            {% else %}
                                <div class="product-image-small d-flex align-items-center justify-content-center" style="background: #f0f0f0;">
                                    <i class="fas fa-image text-muted"></i>
                                </div>
                            {% endif %}
                            <div class="flex-grow-1">
                                <div class="fw-bold">{{ item.product.name }}</div>
                                <small>Qt√©: {{ item.quantity }}</small>
                            </div>
                            <div class="product-price">{{ item.subtotal }} ‚Ç¨</div>
                        </div>
                        {% endfor %}

                        <div class="mt-4">
                            <div class="summary-line">
                                <span>Sous-total</span>
                                <span>{{ total_amount }} ‚Ç¨</span>
                            </div>
                            <div class="summary-line">
                                <span>Livraison</span>
                                <span class="text-success fw-bold">GRATUIT</span>
                            </div>
                            <div class="summary-line summary-total">
                                <span>Total</span>
                                <span>{{ total_amount }} ‚Ç¨</span>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
