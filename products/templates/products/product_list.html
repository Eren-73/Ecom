<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Liste des produits</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', sans-serif;
        padding-top: 30px;
    }

    h1 {
        color: #007bff;
    }

    .card-product {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 25px;
        background: #fff;
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        min-height: 400px;
        justify-content: space-between;
    }

    .card-product:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

    .card-product img {
        max-width: 100%;
        border-radius: 10px;
        margin-bottom: 15px;
        height: 180px;
        object-fit: cover;
    }

    .filter-bar {
        margin-bottom: 25px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
    }

    .filter-bar select,
    .filter-bar input {
        max-width: 200px;
    }

    .btn-add {
        margin-left: auto;
    }

    .product-actions a {
        margin-right: 5px;
    }

    .badge-stock {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: bold;
        margin-bottom: 8px;
    }
    .in-stock { background-color: #28a745; color: #fff; }
    .out-stock { background-color: #dc3545; color: #fff; }

    .product-tags span {
        display: inline-block;
        background: #e9ecef;
        color: #495057;
        padding: 2px 8px;
        border-radius: 8px;
        font-size: 0.8rem;
        margin: 2px;
    }

    .btn-details {
        margin-top: 10px;
    }
</style>
</head>
<body>
<div class="container">

    <div class="d-flex align-items-center mb-4 flex-wrap">
        <a href="{% url 'dashboard_vendor' %}" class="btn btn-outline-secondary me-3 mb-2">← Retour au dashboard</a>
        <h1 class="m-0 mb-2">Liste des produits</h1>
        <div class="ms-auto mb-2">
            <a href="{% url 'product_create' %}" class="btn btn-primary me-2">Ajouter un produit</a>
            <a href="{% url 'category_create' %}" class="btn btn-secondary">Ajouter une catégorie</a>
        </div>
    </div>

    <!-- Formulaire de filtrage -->
    <form method="get" class="filter-bar">
        <select name="category" class="form-select">
            <option value="">Toutes les catégories</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == selected_category %}selected{% endif %}>
                    {{ cat.name }}
                </option>
            {% endfor %}
        </select>
        <input type="text" name="tag" class="form-control" placeholder="Filtrer par tag" value="{{ selected_tag }}">
        <button type="submit" class="btn btn-info">Filtrer</button>
    </form>

    <!-- Liste des produits -->
    <div class="row">
        {% for product in products %}
        <div class="col-md-4">
            <div class="card-product">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                {% else %}
                <img src="https://via.placeholder.com/250x180?text=Pas+d'image" alt="Pas d'image">
                {% endif %}

                <h5 class="mb-2"><a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">{{ product.name }}</a></h5>

                <span class="badge-stock {% if product.is_in_stock %}in-stock{% else %}out-stock{% endif %}">
                    {% if product.is_in_stock %}Disponible{% else %}Rupture de stock{% endif %}
                </span>

                <p class="mb-1"><strong>Prix :</strong> {{ product.price }} €</p>
                <p class="mb-1"><strong>Catégorie :</strong> {{ product.category.name }}</p>

                {% if product.tags.exists %}
                <div class="product-tags mb-1">
                    {% for tag in product.tags.all %}
                        <span>{{ tag.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <p class="text-truncate" style="max-width:100%;">{{ product.description|truncatewords:15 }}</p>

                <a href="{{ product.get_absolute_url }}" class="btn btn-sm btn-primary btn-details">Voir les détails</a>

                {% if product.vendor.user == request.user %}
                <div class="product-actions mt-2">
                    <a href="{% url 'product_edit' product.pk %}" class="btn btn-sm btn-success">Modifier</a>
                    <a href="{% url 'product_delete' product.pk %}" class="btn btn-sm btn-danger">Supprimer</a>
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p class="text-center mt-4">Aucun produit trouvé.</p>
        {% endfor %}
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
